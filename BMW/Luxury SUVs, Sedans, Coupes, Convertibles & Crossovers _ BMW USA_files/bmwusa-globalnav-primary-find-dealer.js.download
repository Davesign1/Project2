/*!
 *  BMWUSA 
 *  Name: globalnav-primary-find-dealer 
 * 
 */!function(modules){function webpackJsonpCallback(data){for(var moduleId,chunkId,chunkIds=data[0],moreModules=data[1],executeModules=data[2],i=0,resolves=[];i<chunkIds.length;i++)chunkId=chunkIds[i],Object.prototype.hasOwnProperty.call(installedChunks,chunkId)&&installedChunks[chunkId]&&resolves.push(installedChunks[chunkId][0]),installedChunks[chunkId]=0;for(moduleId in moreModules)Object.prototype.hasOwnProperty.call(moreModules,moduleId)&&(modules[moduleId]=moreModules[moduleId]);for(parentJsonpFunction&&parentJsonpFunction(data);resolves.length;)resolves.shift()();return deferredModules.push.apply(deferredModules,executeModules||[]),checkDeferredModules()}function checkDeferredModules(){for(var result,i=0;i<deferredModules.length;i++){for(var deferredModule=deferredModules[i],fulfilled=!0,j=1;j<deferredModule.length;j++){var depId=deferredModule[j];0!==installedChunks[depId]&&(fulfilled=!1)}fulfilled&&(deferredModules.splice(i--,1),result=__webpack_require__(__webpack_require__.s=deferredModule[0]))}return result}var installedModules={},installedChunks={45:0},deferredModules=[];function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.l=!0,module.exports}__webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.d=function(exports,name,getter){__webpack_require__.o(exports,name)||Object.defineProperty(exports,name,{enumerable:!0,get:getter})},__webpack_require__.r=function(exports){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(exports,"__esModule",{value:!0})},__webpack_require__.t=function(value,mode){if(1&mode&&(value=__webpack_require__(value)),8&mode)return value;if(4&mode&&"object"==typeof value&&value&&value.__esModule)return value;var ns=Object.create(null);if(__webpack_require__.r(ns),Object.defineProperty(ns,"default",{enumerable:!0,value}),2&mode&&"string"!=typeof value)for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns},__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module.default}:function getModuleExports(){return module};return __webpack_require__.d(getter,"a",getter),getter},__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)},__webpack_require__.p="/etc/designs/bmwusa/bmwusa-clientlibs/";var jsonpArray=window.webpackJsonp=window.webpackJsonp||[],oldJsonpFunction=jsonpArray.push.bind(jsonpArray);jsonpArray.push=webpackJsonpCallback,jsonpArray=jsonpArray.slice();for(var i=0;i<jsonpArray.length;i++)webpackJsonpCallback(jsonpArray[i]);var parentJsonpFunction=oldJsonpFunction;deferredModules.push([40,0]),checkDeferredModules()}({"./frontend_src/components/globalnav-primary-find-dealer/js/globalnav-primary-find-dealer.js":function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _component=__webpack_require__("./frontend_src/bmwlib/component.js"),_validator=__webpack_require__("./frontend_src/bmwlib/validator.js"),_dealerInfo=__webpack_require__("./frontend_src/bmwlib/api-services/dealer-info.js");var _default=new _component.Component({el:".globalnav-primary-find-dealer",name:"globalnav-primary-find-dealer Component",currentBreakpoint:768>window.innerWidth?"mobile":960<window.innerWidth?"desktop":"tablet",baseStr:"globalnav-primary-find-dealer",subscriptions:{"window.resizeEnd":"resizeEvt","nav.toggleMyBMW":"toggleMyBMW","fill.clicked":"closeZip","zip.update":"dealerUpdate","my-bmw.open":"closeZip"},dealerIsSet:!1,changeCopy:!1,mobileHasRun:!1,logoStr:"globalnav-primary__BMW-logo-holder",init(){this.dealerData=_dealerInfo.DealerInfoApi.getDealerInfo(),this.dealer=this.element.querySelector(this.el+"__find-dealer"),this.dealerBar=this.element.querySelector(this.el+"__bar"),this.findDealer=this.element.querySelector(this.el+"__set-dealer"),this.dealerInfo=this.element.querySelector(this.el+"__dealer-set"),this.editBtn=this.element.querySelector(this.el+"__zip-change"),this.zip=this.element.querySelector(this.el+"__zip-holder"),this.cancel=this.element.querySelector(this.el+"__zip-cancel"),this.zipForm=this.element.querySelector(this.el+"__zip"),this.zipInput=this.zipForm.querySelector("input"),this.error=this.element.querySelector(this.el+"__zip-error"),this.dealerLocation=this.element.querySelector(this.el+"__location"),this.dealerName=this.element.querySelector(this.el+"__name"),this.dealerData=_dealerInfo.DealerInfoApi.isDealerSet(),this.loader=this.element.querySelector(this.el+"__loader"),this.errorIcon=this.element.querySelector(this.el+"__zip-error-icon"),this.editBtnMobile=this.element.querySelector(this.el+"__mobile-arrow"),this.logo=document.querySelector("."+this.logoStr),this.showZip=this.showZip.bind(this),this.closeZip=this.closeZip.bind(this),this.submitForm=this.submitForm.bind(this),this.toggleZip=this.toggleZip.bind(this),this.dealerUpdate=this.dealerUpdate.bind(this),this.zipForm.addEventListener("submit",this.submitForm),this.cancel.addEventListener("click",this.closeZip),"desktop"===this.currentBreakpoint?(this.setOffSet(),this.desktopEvt()):(this.mobileHasRun=!0,this.mobileEvt()),this.dealerData&&(this.dealerData.pageLoad=!0,this.displayDealerInfo(!0),PubSub.publish("nav.dealerSet",this.dealerData))},desktopEvt(){this.findDealer.addEventListener("click",this.showZip),this.editBtn.addEventListener("click",this.showZip)},mobileEvt(){this.findDealer.addEventListener("click",this.toggleZip),this.editBtnMobile.addEventListener("click",this.toggleZip)},killDesktopEvt(){this.findDealer.removeEventListener("click",this.showZip),this.editBtn.removeEventListener("click",this.showZip)},killMobileEvt(){this.findDealer.removeEventListener("click",this.toggleZip),this.editBtnMobile.removeEventListener("click",this.toggleZip)},setOffSet(){this.offset||(this.offset=getComputedStyle(this.zip,null).getPropertyValue("right"))},toggleMyBMW(){"desktop"!==this.currentBreakpoint&&(this.dealer.classList.toggle(this.baseStr+"__find-dealer--inactive"),this.toggleZip("close"),this.toggleFill(!0))},toggleZip(e){const openStr=this.baseStr+"__zip-holder--active",isZipOpen=this.zip.classList.contains(openStr);"close"===e?(this.zip.classList.remove(openStr),this.toggleIcon(!0),document.body.classList.remove("globalnav-primary--kill-scroll")):(this.zip.classList.toggle(openStr),this.toggleIcon(),this.dealerBar.classList.add("overflow__visible")),isZipOpen?(PubSub.publish("local.nav.close"),this.closeErrorMessage(),setTimeout(()=>{this.dealerBar.classList.remove("overflow__visible")},750),document.body.classList.remove("globalnav-primary--kill-scroll")):document.body.classList.add("globalnav-primary--kill-scroll"),this.toggleFill()},toggleFill(close=!1,open=!1){PubSub.publish("nav.toggleFill",{className:"globalnav-primary-fill--active-dealer",close,open})},toggleIcon(close=!1){const iconClass=this.baseStr+"__find-dealer--open";close?this.dealer.classList.remove(iconClass):this.dealer.classList.toggle(iconClass)},trackSatellite(e){window.GlobalMessage&&window.GlobalMessage("measure.dtm.track",e)},showZip(){this.dealerIsSet&&this.dealerInfo.classList.remove(this.baseStr+"__dealer-set--active"),PubSub.publish("dealer.open",!0),this.toggleFill(!1,!0),this.logo.classList.add(this.logoStr+"--fill"),this.zip.classList.add(this.baseStr+"__zip-holder--active"),window.addEventListener("scroll",this.closeZip)},submitForm(e){e.preventDefault();const inputVal=this.zipInput.value;_validator.Validator.validateZipCode(inputVal)?(this.closeErrorMessage(),this.loader.classList.add(this.baseStr+"__loader--loading"),_dealerInfo.DealerInfoApi.updateFromZip(inputVal).then(data=>{this.dealerData=data,this.displayDealerInfo(),this.closeZip()}).reject(err=>{this.showErrorMessage(),this.debug("error",err)}),this.zipInput.blur(),this.trackSatellite("dtmMACOZipSubmission")):(this.showErrorMessage(),this.trackSatellite("dtmMACOZipError"))},showErrorMessage(){let zipW=null,setW=null;this.killLoader(),this.errorIcon.classList.add(this.baseStr+"__zip-error-icon--active"),"desktop"===this.currentBreakpoint&&(zipW=getComputedStyle(this.zip,null).getPropertyValue("width"),setW=parseInt(zipW,10)+parseInt(this.offset,10),this.error.style.width=setW+"px"),this.error.classList.add(this.baseStr+"__zip-error--active")},closeErrorMessage(){this.error.classList.remove(this.baseStr+"__zip-error--active"),this.errorIcon.classList.remove(this.baseStr+"__zip-error-icon--active"),setTimeout(()=>{this.error.style.width=""},300)},dealerUpdate(event,data){this.dealerData=data,this.displayDealerInfo(!0)},displayDealerInfo(hide=!1){const{dealer,maco}=this.dealerData,tracking=name=>name.toLowerCase().split(" ").join("-"),dealerName=`<span>${this.dealerName.dataset.dealerCopy}</span>\n                          <a\n                            href="${dealer.Url}"\n                            analytics-on=""\n                            analytics-event="topnav.tier3.${tracking(dealer.Name)}.link">\n                              ${this.ellipsis(dealer.Name,"dealer")}\n                          </a>`,dealerMaco=`<a href="${maco.Url}"\n                            analytics-on=""\n                            analytics-event="topnav.tier2.${tracking(maco.Display)}.link">\n                              ${this.ellipsis(maco.Display,"maco")}\n                          </a>`;this.dealerIsSet=!0,this.dealerLocation.innerHTML=dealerMaco,this.dealerName.innerHTML=dealerName,"desktop"!==this.currentBreakpoint||hide?(this.findDealer.classList.add(this.baseStr+"__set-dealer--fade"),hide&&setTimeout(()=>{this.hideFindDealer(),this.toggleCopy(),setTimeout(()=>{this.showDealer()},100)},305)):this.hideFindDealer()},ellipsis(content,type){const w=window.innerWidth,setting="maco"===type?[32,45,15]:[0,15,18],copy=val=>content.substring(0,val)+"...";return 768>w&&content.length>setting[2]?copy(setting[2]):768<=w&&960>w&&content.length>setting[1]?copy(setting[1]):"dealer"!==type&&content.length>setting[0]?copy(setting[0]):content},killLoader(){this.loader.classList.remove(this.baseStr+"__loader--loading")},closeZip(e){this.zip.classList.contains(this.baseStr+"__zip-holder--active")&&(this.zip.classList.remove(this.baseStr+"__zip-holder--active"),this.killLoader(),this.closeErrorMessage(),this.dealerIsSet?setTimeout(()=>{this.showDealer(),"desktop"!==this.currentBreakpoint&&(this.toggleIcon(),this.hideFindDealer()),this.changeCopy||this.toggleCopy()},301):"desktop"!==this.currentBreakpoint&&this.toggleIcon(!0),"desktop"===this.currentBreakpoint&&window.removeEventListener("scroll",this.closeZip),"my-bmw.open"!==e&&this.logo.classList.remove(this.logoStr+"--fill"),this.toggleFill(!0))},hideFindDealer(){this.dealerInfo.classList.remove(this.baseStr+"__dealer-set--hide"),this.findDealer.classList.add(this.baseStr+"__set-dealer--hide")},toggleCopy(){this.changeCopy=!0;const copy=document.createTextNode(this.zip.dataset.updateCopy.trim()),label=this.zip.querySelector("label span");label.textContent="",label.appendChild(copy)},showDealer(){this.dealerInfo.classList.add(this.baseStr+"__dealer-set--active")},checkEvtSettings(){this.mobileHasRun||(this.mobileHasRun=!0,this.killDesktopEvt(),this.mobileEvt())},resizeEvt(e,resizeObj){const w=resizeObj.width;768>w&&"mobile"!==this.currentBreakpoint?(this.currentBreakpoint="mobile",this.checkEvtSettings(),this.dealerData&&this.displayDealerInfo()):960>w&&768<=w&&"tablet"!==this.currentBreakpoint?(this.currentBreakpoint="tablet",this.checkEvtSettings(),this.dealerData&&this.displayDealerInfo()):960<=w&&"desktop"!==this.currentBreakpoint&&(this.mobileHasRun=!1,this.currentBreakpoint="desktop",this.killMobileEvt(),this.desktopEvt(),this.setOffSet(),this.dealerData&&this.displayDealerInfo(),this.dealer.classList.remove(this.baseStr+"__find-dealer--inactive"))}});exports.default=_default,module.exports=exports.default},40:function(module,exports,__webpack_require__){module.exports=__webpack_require__("./frontend_src/components/globalnav-primary-find-dealer/js/globalnav-primary-find-dealer.js")}});
//# sourceMappingURL=/etc/designs/bmwusa/bmwusa-clientlibs/bmwusa-sourcemaps/bmwusa-globalnav-primary-find-dealer-203902800b3faaf5f071.js.map