/*!
 *  BMWUSA 
 *  Name: dealer-map-location-search 
 * 
 */!function(modules){function webpackJsonpCallback(data){for(var moduleId,chunkId,chunkIds=data[0],moreModules=data[1],executeModules=data[2],i=0,resolves=[];i<chunkIds.length;i++)chunkId=chunkIds[i],Object.prototype.hasOwnProperty.call(installedChunks,chunkId)&&installedChunks[chunkId]&&resolves.push(installedChunks[chunkId][0]),installedChunks[chunkId]=0;for(moduleId in moreModules)Object.prototype.hasOwnProperty.call(moreModules,moduleId)&&(modules[moduleId]=moreModules[moduleId]);for(parentJsonpFunction&&parentJsonpFunction(data);resolves.length;)resolves.shift()();return deferredModules.push.apply(deferredModules,executeModules||[]),checkDeferredModules()}function checkDeferredModules(){for(var result,i=0;i<deferredModules.length;i++){for(var deferredModule=deferredModules[i],fulfilled=!0,j=1;j<deferredModule.length;j++){var depId=deferredModule[j];0!==installedChunks[depId]&&(fulfilled=!1)}fulfilled&&(deferredModules.splice(i--,1),result=__webpack_require__(__webpack_require__.s=deferredModule[0]))}return result}var installedModules={},installedChunks={25:0},deferredModules=[];function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.l=!0,module.exports}__webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.d=function(exports,name,getter){__webpack_require__.o(exports,name)||Object.defineProperty(exports,name,{enumerable:!0,get:getter})},__webpack_require__.r=function(exports){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(exports,"__esModule",{value:!0})},__webpack_require__.t=function(value,mode){if(1&mode&&(value=__webpack_require__(value)),8&mode)return value;if(4&mode&&"object"==typeof value&&value&&value.__esModule)return value;var ns=Object.create(null);if(__webpack_require__.r(ns),Object.defineProperty(ns,"default",{enumerable:!0,value}),2&mode&&"string"!=typeof value)for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns},__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module.default}:function getModuleExports(){return module};return __webpack_require__.d(getter,"a",getter),getter},__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)},__webpack_require__.p="/etc/designs/bmwusa/bmwusa-clientlibs/";var jsonpArray=window.webpackJsonp=window.webpackJsonp||[],oldJsonpFunction=jsonpArray.push.bind(jsonpArray);jsonpArray.push=webpackJsonpCallback,jsonpArray=jsonpArray.slice();for(var i=0;i<jsonpArray.length;i++)webpackJsonpCallback(jsonpArray[i]);var parentJsonpFunction=oldJsonpFunction;deferredModules.push([20,0]),checkDeferredModules()}({"./frontend_src/bmwlib/api-services/dealer-search.js":function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__("./node_modules/@babel/runtime/helpers/interopRequireDefault.js");Object.defineProperty(exports,"__esModule",{value:!0}),exports.DealerSearch=void 0;var _baseDealerApi=_interopRequireDefault(__webpack_require__("./frontend_src/bmwlib/utility/base-dealer-api.js")),_dataNormalization=_interopRequireDefault(__webpack_require__("./frontend_src/bmwlib/api-services/data-normalization.js")),_dealerInfo=__webpack_require__("./frontend_src/bmwlib/api-services/dealer-info.js");class DealerSearch extends _baseDealerApi.default{constructor(){super(),this.searchResults=this.searchResults.bind(this)}latLonSearch(val,callback,raw=!1,serviceType=null){const{Lat,Lon}=val;let endpoint=`?dealers/coordinate/${Lat.toFixed(6)},${Lon.toFixed(6)}?pmaOnly=false&includeSatelliteDealers=true`;serviceType&&(endpoint+="?serviceType="+serviceType),this.getData(endpoint,(err,res)=>{this.searchResults(err,res,callback,raw)})}searchCity(val,callback,raw=!1,serviceType=null){const{state,city}=val;let endpoint=`?getdealerdetailsByCityState/?city=${encodeURI(city)}&state=${state}&includeSatelliteDealers=true`;serviceType&&(endpoint+="&serviceType="+serviceType),this.getData(endpoint,(err,res)=>{this.searchResults(err,res,callback,raw)})}searchZip(val,callback,raw=!1,serviceType=null,type=null){let endpoint=`?getdealerdetailsByRadius/${val}/100?includeSatelliteDealers=true`;serviceType&&(endpoint+="/"+serviceType),this.getData(endpoint,(err,res)=>{this.searchResults(err,res,callback,raw,type)})}searchDealer(val,callback,raw=!1){this.getData("?getdealerdetailsByDealerName?dealerName="+encodeURI(val),(err,res)=>{this.searchResults(err,res,callback,raw)})}getMaco(){_dealerInfo.DealerInfoApi.getMacoDataApi(utility.CleanZip(ZipCode)).then(res=>{this.macoData(res)}).catch(err=>{console.error(err),this.toggleErrorState(this.dealerSearchInput,!0)})}macoResults(err,res,callback){if(null!==err)callback(err,!0);else{const macoData=_dataNormalization.default.maco(res);macoData?callback(err,macoData):callback("bad response",!0)}}searchResults(err,res,callback,raw=!1,type=null){if(err)this.raiseEvent("dealer-search","dealer search error","error",err),callback(err,res);else{let searchData;if(raw){var _searchData$dataConte,_searchData$dataConte2,_searchData$dataConte3,_searchData$dataConte4;searchData=_dataNormalization.default.parseData(res.text),searchData.Results=_dataNormalization.default.dealerData(res),searchData.Maco=_dataNormalization.default.maco(res);const lat=+(null===(_searchData$dataConte=searchData.dataContent)||void 0===_searchData$dataConte||null===(_searchData$dataConte2=_searchData$dataConte.dealerDetails)||void 0===_searchData$dataConte2?void 0:_searchData$dataConte2.latitude)||null,lon=+(null===(_searchData$dataConte3=searchData.dataContent)||void 0===_searchData$dataConte3||null===(_searchData$dataConte4=_searchData$dataConte3.dealerDetails)||void 0===_searchData$dataConte4?void 0:_searchData$dataConte4.longitude)||null;searchData.Center=_dataNormalization.default.coordinate({Lat:lat,Lon:lon})}else searchData=_dataNormalization.default.dealerData(res);searchData?callback(err,searchData,type):callback(!0,"bad response")}}}exports.DealerSearch=DealerSearch},"./frontend_src/bmwlib/utility/autocomplete-keyboard.js":function(module,exports,__webpack_require__){"use strict";var _defineProperty2=__webpack_require__("./node_modules/@babel/runtime/helpers/interopRequireDefault.js")(__webpack_require__("./node_modules/@babel/runtime/helpers/defineProperty.js"));Object.defineProperty(exports,"__esModule",{value:!0}),exports.AutocompleteKeyboard=void 0;exports.AutocompleteKeyboard=class AutocompleteKeyboard{constructor(){(0,_defineProperty2.default)(this,"count",-1),(0,_defineProperty2.default)(this,"reset",()=>{this.count=-1})}runKeyboardHighlights(settings={max:0,activeStr:"",resultItems:null,activeItem:null},dir=null){const{max,activeStr,resultItems,activeItem}=settings;let setItem=null;return"up"===dir?this.count--:"down"===dir&&this.count++,this.count>=max&&(this.count=0),0>this.count&&(this.count=max-1),activeItem&&activeItem.classList.remove(activeStr),setItem=resultItems[this.count],setItem.classList.add(""+activeStr),setItem}}},"./frontend_src/components/dealer-map-location-search/js/dealer-map-location-search.js":function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _component=__webpack_require__("./frontend_src/bmwlib/component.js"),_dealerSearch=__webpack_require__("./frontend_src/bmwlib/api-services/dealer-search.js"),_dealerInfo=__webpack_require__("./frontend_src/bmwlib/api-services/dealer-info.js"),_autocompleteKeyboard=__webpack_require__("./frontend_src/bmwlib/utility/autocomplete-keyboard.js"),_validator=__webpack_require__("./frontend_src/bmwlib/validator.js"),_component2=__webpack_require__("./frontend_src/bmwlib/component.js");var _default=new _component.Component({el:".dealer-map-location-search",name:"dealer-map-location-search Component",events:{"keyup input":"checkInput"},subscriptions:{"map.done":"mapLoaded","dealer.outside-click":"closeAutocomplete","dealermap.search":"searchDisplayToggle","dealermap.component-embedded":"prefillDealerZip","whereIWantForm.dealer.setGlobalFromForm":"setFromForm"},total:3,baseStr:"dealer-map-location-search",mapIsLoaded:!1,autocompleteOptions:{types:["(cities)"],componentRestrictions:{country:"us"}},keyCodes:[27,13,40,38],prevName:[],maxCount:50,searchTerm:"",currentSearch:"",dtmSearchError:"dtmDealerLocatorModalSearchError",dtmSearchSuccess:"dtmDealerLocatorModalSearchSuccess",dtmSearchSuccessFromForm:"DTM_AA_DealerLocatorFormZipSuccess",zipCodeCookieName:"user_zipcode",beforeInit(){this.dealerSearch=new _dealerSearch.DealerSearch,this.autocompleteKeyboard=new _autocompleteKeyboard.AutocompleteKeyboard,this.inputs=this.element.querySelectorAll("input"),this.dealerSearchInput=this.element.querySelector('input[name="dealer-search"]'),this.dealerLocationInput=this.element.querySelector('input[name="location-search"]'),this.dealerResultsHolder=this.dealerSearchInput.parentNode.querySelector(this.el+"__autocomplete"),this.dealerResultsHolderNav=this.dealerResultsHolder.querySelector("nav"),this.submitBtn=this.element.querySelector(this.el+"__search-btn"),this.inputHolder=this.element.querySelectorAll(this.el+"__input-holder"),this.submitBtnStateChanged,this.searchResultsDealer=this.searchResultsDealer.bind(this),this.mapLoaded=this.mapLoaded.bind(this),this.autoFillSelected=this.autoFillSelected.bind(this),this.processSearch=this.processSearch.bind(this),this.dealerNameClick=this.dealerNameClick.bind(this),this.dealerLocationData=this.dealerLocationData.bind(this),this.dealerCityZipSearchResults=this.dealerCityZipSearchResults.bind(this),this.focusState=this.focusState.bind(this),this.macoData=this.macoData.bind(this),this.closeAutocomplete=this.closeAutocomplete.bind(this),this.toggleLoading=this.toggleLoading.bind(this),this.dealerResultsHolderNav.addEventListener("click",this.dealerNameClick),this.element.addEventListener("submit",this.processSearch),this.submitBtn.addEventListener("click",this.processSearch),this.dealerLocationInput.addEventListener("focus",this.focusState)},init(){for(let i=0;i<this.inputHolder.length;i++)this.inputHolder[i].addEventListener("click",this.cancelProp)},mapLoaded(){this.autocomplete=new google.maps.places.Autocomplete(this.dealerLocationInput,this.autocompleteOptions),this.autocomplete.addListener("place_changed",this.autoFillSelected)},autoFillSelected(){let cords,city,state;const place=this.autocomplete.getPlace(),isNum=!isNaN(name),isValidZip=_validator.Validator.validateZipCode(name);if(place&&place.address_components){this.toggleLoading(!0);const{address_components,geometry,name}=place;if(address_components.forEach(address=>{-1<address.types.indexOf("locality")&&(city=address.long_name),-1<address.types.indexOf("administrative_area_level_1")&&(state=address.short_name)}),geometry){const{lat,lng}=geometry.location;cords={Lat:lat(),Lon:lng()}}city&&state?(this.searchTerm=city+", "+state,this.currentSearch="searchCity",this.dealerSearch.searchCity({state,city},(err,res)=>{cords=!!geometry&&cords,this.dealerCityZipSearchResults(err,res,cords)},!0)):geometry?(this.searchTerm=cords.Lat.toFixed(3)+", "+cords.Lon.toFixed(3),this.currentSearch="latLonSearch",this.dealerSearch.latLonSearch(cords,this.dealerCityZipSearchResults,!0)):this.toggleErrorState(this.dealerLocationInput,!0)}else isNum||isValidZip||(this.toggleLoading(),this.toggleErrorState(this.dealerLocationInput,!0))},dealerCityZipSearchResults(err,res,cords=!1){"latLonSearch"!=this.currentSearch&&this.toggleLoading(),err?this.toggleErrorState(this.dealerLocationInput,!0):(0<res.Results.length?(this.toggleErrorState(this.dealerLocationInput),this.sendData(res)):cords?(this.currentSearch="latLonSearch",this.dealerSearch.latLonSearch(cords,this.dealerCityZipSearchResults,!0)):this.sendData({Results:[]}),GlobalMessage("measure.dtm.track",this.dtmSearchSuccess))},prefillDealerZip(){const dealer=_dealerInfo.DealerInfoApi.getDealer();dealer&&setTimeout(()=>{this.dealerLocationInput.value=dealer.ZipCode,this.submitBtn.disabled=!1},250)},cancelProp(e){e.stopImmediatePropagation()},checkInput(e){switch(e.stopImmediatePropagation(),27===e.which&&""===e.target.value?PubSub.publish("map.close-map"):27===e.which&&this.clearSearch(),""===e.target.value?this.inputs.forEach(input=>{e.target!==input&&""===input.value&&(this.submitBtn.disabled=!0)}):this.submitBtn.disabled=!1,this.submitBtnStateChanged!==this.submitBtn.disabled&&(PubSub.publish("map.set-trap-focus"),this.submitBtnStateChanged=this.submitBtn.disabled),e.target.name){case"dealer-search":this.searchDealerName(e);break;case"location-search":this.locationSearch(e)}},focusState(){this.killResults()},locationSearch(e){13===e.which&&this.runValidator(e.target)},toggleLoading(show=!1){const activeStr=this.baseStr+"__search-btn--active";show?this.submitBtn.classList.add(activeStr):this.submitBtn.classList.remove(activeStr)},dealerLocationData(err,res,type){this.toggleLoading(),err?this.toggleErrorState(this.dealerLocationInput,!0):(0<res.Results.length?(this.toggleErrorState(this.dealerLocationInput),this.sendData(res),_component.utility.cookies.verifyAndSet(!1,this.zipCodeCookieName,this.searchTerm)):this.toggleErrorState(this.dealerLocationInput,!0),GlobalMessage("measure.dtm.track","form"===type?this.dtmSearchSuccessFromForm:this.dtmSearchSuccess))},setFromForm(e,dealerzipCode){this.dealerSearch.searchZip(dealerzipCode,this.dealerLocationData,!0,null,"form")},typingTimer:null,doneTypingInterval:250,searchDealerName(e){const elem=e.target,val=elem.value,noSearch=!!(-1<this.keyCodes.indexOf(e.which)),isEmpty=""===val,isDealerResultsOpen=this.isDealerResultsOpen();13===e.which&&isEmpty&&this.toggleErrorState(elem,!0),isEmpty?this.killResults():noSearch?13===e.which&&this.checkDealerData(elem):(clearTimeout(this.typingTimer),this.typingTimer=setTimeout(()=>{this.doneTyping(val)},this.doneTypingInterval)),(isDealerResultsOpen&&40===e.which||38===e.which)&&(40===e.which?this.setActiveDealerResults("down"):this.setActiveDealerResults("up"))},doneTyping(val){this.currentSearch="searchDealer",this.dealerSearch.searchDealer(val,this.searchResultsDealer)},searchResultsDealer(err,res){err?(this.toggleErrorState(this.dealerSearchInput,!0),this.debug("error",err)):(this.dealerResults=res,0<this.dealerResults.length?(this.toggleErrorState(this.dealerSearchInput),this.displayDealerResults()):this.killResults())},setActiveDealerResults(dir){const buttons=this.dealerResultsHolder.querySelectorAll("button"),activeStr=this.baseStr+"__autocomplete-item--active",activeItem=this.dealerResultsHolder.querySelector("."+activeStr);this.autocompleteKeyboard.runKeyboardHighlights({max:buttons.length,activeStr,resultItems:buttons,activeItem},dir)},toggleErrorState(elem,show=!1){const error=elem.parentNode,activeStr=this.baseStr+"__input--error";show?(error.classList.add(""+activeStr),GlobalMessage("measure.event.fieldError",_component2.$dom.text(error).trim()),GlobalMessage("measure.dtm.track",this.dtmSearchError)):error.classList.remove(""+activeStr)},displayDealerResults(){let button="";const activeStr=this.baseStr+"__autocomplete--active",list=this.dealerResults.slice(0,this.total),isMatch=!!this.isDealerResultsOpen()&&_component.utility.matchArrayVal(this.prevName,list,"Name"),isActive=this.isDealerResultsOpen();isMatch||""===this.dealerSearchInput.value||(this.prevName=[],list.forEach(dealer=>{const{Name}=dealer,name=Name.length>this.maxCount?Name.substring(0,this.maxCount)+"...":Name;button+=`<button\n                        type="button"\n                        name="${name}"\n                        class="${this.baseStr}__autocomplete-item">\n                      ${name}\n                    </button>`,this.prevName.push(Name)}),this.dealerResultsHolderNav.innerHTML=button,!isActive&&this.dealerResultsHolder.classList.add(activeStr),this.toggleErrorState(this.dealerSearchInput))},isDealerResultsOpen(){const activeStr=this.baseStr+"__autocomplete--active";return this.dealerResultsHolder.classList.contains(activeStr)},checkDealerData(elem){if(this.isDealerResultsOpen()){const names=this.dealerResultsHolder.querySelectorAll("button"),activeItem=this.dealerResultsHolder.querySelector(this.el+"__autocomplete-item--active");let index=0,item=names[index];activeItem&&(index=_component2.$dom.elementIndex(activeItem),item=names[index]),elem.value=item.textContent.trim(),this.selectedDealership=this.dealerResults[index],this.macoSetup(this.selectedDealership)}else this.toggleErrorState(elem,!0)},dealerNameClick(e){if(e.target&&e.target.matches(this.el+"__autocomplete-item")){const elem=e.target,index=_component2.$dom.elementIndex(elem);this.selectedDealership=this.dealerResults[index],this.dealerSearchInput.value=elem.textContent.trim(),this.macoSetup(this.selectedDealership),GlobalMessage("measure.dtm.track",this.dtmSearchSuccess)}},macoSetup(dealer){const{ZipCode,Name}=dealer;this.searchTerm=Name,this.closeAutocomplete(null),this.toggleLoading(!0),_dealerInfo.DealerInfoApi.getMacoDataApi(_component.utility.CleanZip(ZipCode)).then(res=>{this.macoData(res)}).catch(err=>{console.error(err),this.toggleErrorState(this.dealerSearchInput,!0)})},macoData(res){this.toggleLoading(),this.setupDealerData({dealer:this.selectedDealership,maco:res})},setupDealerData(data){this.currentSearch="singleDealer";const{dealer,maco}=data;this.sendData({Results:[dealer],Maco:maco})},sendData(data){_dealerInfo.DealerInfoApi.setDealerList(data.Results),_dealerInfo.DealerInfoApi.setMaco(data.Maco),this.clearSearch(),data.Term=this.searchTerm||"",this.toggleLoading(),PubSub.publish("dealermap.dealer-selected",{dealer:data.Results[0],maco:data.Maco,payload:data.Results}),data.currentSearch=this.currentSearch,PubSub.publish("dealermap.search-results",data),this.searchDisplayToggle(null)},searchDisplayToggle(eventName,show=!1){const activeStr=this.baseStr+"--active";if(show)if(show.lat&&show.lng){const coords={Lat:show.lat,Lon:show.lng};this.searchTerm=show.lat.toFixed(3)+", "+show.lng.toFixed(3),this.currentSearch="latLonSearch",this.dealerSearch.latLonSearch(coords,this.dealerCityZipSearchResults,!0)}else this.clearSearch();else this.element.classList.remove(activeStr)},clearSearch(){this.dealerResults=[],this.killResults();for(let i=0;i<this.inputs.length;i++)this.inputs[i].value=""},closeAutocomplete(){this.killResults()},killResults(){this.autocompleteKeyboard.reset(),this.dealerResultsHolder.classList.remove(this.baseStr+"__autocomplete--active")},runValidator(elem,numCheck=!0){let val=elem.value;const isValidZip=_validator.Validator.validateZipCode(val),isNum=!isNaN(val);isValidZip?(val=_component.utility.CleanZip(val),this.toggleLoading(!0),this.searchTerm=val,this.currentSearch="searchZip",this.dealerSearch.searchZip(val,this.dealerLocationData,!0),GlobalMessage("measure.user.location",{zipCode:val})):(numCheck&&isNum||!numCheck)&&this.toggleErrorState(this.dealerLocationInput,!0)},processSearch(e){e.preventDefault();for(let i=0;i<this.inputs.length;i++){const input=this.inputs[i],val=input.value,name=input.name;""!==val&&("location-search"===name?(this.runValidator(input,!1),PubSub.publish("dealer.pagination-disabled","prev")):this.toggleErrorState(input,!0))}}});exports.default=_default,module.exports=exports.default},20:function(module,exports,__webpack_require__){module.exports=__webpack_require__("./frontend_src/components/dealer-map-location-search/js/dealer-map-location-search.js")}});
//# sourceMappingURL=/etc/designs/bmwusa/bmwusa-clientlibs/bmwusa-sourcemaps/bmwusa-dealer-map-location-search-203902800b3faaf5f071.js.map