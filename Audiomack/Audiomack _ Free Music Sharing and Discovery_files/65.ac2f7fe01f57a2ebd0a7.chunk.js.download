(window.webpackJsonp=window.webpackJsonp||[]).push([[65],{LpGO:function(e,t,a){"use strict";var n=a("KI45"),s=a("hfKm"),i=a("pbKT");s(t,"__esModule",{value:!0}),t.default=void 0;var o=n(a("eVuF")),r=n(a("/HRN")),u=n(a("WaGi")),l=n(a("K47E")),c=n(a("N9n2")),d=n(a("ZDA2")),h=n(a("/+P4")),p=n(a("xHqa")),f=a("Ajvz"),m=n(a("gpBo")),S=a("/MKj"),y=a("lqBu"),v=a("31zi"),_=n(a("juIi")),C=a("m6eX");function g(e){var t=function(){if("undefined"==typeof Reflect||!i)return!1;if(i.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(i(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=(0,h.default)(e);if(t){var s=(0,h.default)(this).constructor;a=i(n,arguments,s)}else a=n.apply(this,arguments);return(0,d.default)(this,a)}}var k=function(e){(0,c.default)(a,e);var t=g(a);function a(e){var n;return(0,r.default)(this,a),n=t.call(this,e),(0,p.default)((0,l.default)(n),"handleAvailablilityChange",(function(e){n.props.onAvailablilityChange(e)})),(0,p.default)((0,l.default)(n),"handleSessionStart",(function(){var e=n.props,t=e.dispatch,a=e.player;t((0,C.setChromecastState)(!0)),n._chromecast.volume(a.volume),n.setChromecastMedia(),n.props.onSessionStart(n._chromecast.deviceName)})),(0,p.default)((0,l.default)(n),"handleSessionStartFailed",(function(){n.props.onSessionStartFailed()})),(0,p.default)((0,l.default)(n),"handleSessionResumed",(function(){var e=n.props,t=e.dispatch,a=e.player;t((0,C.setChromecastState)(!0)),n._chromecast.volume(a.volume),n.props.onSessionResumed(n._chromecast.deviceName)})),(0,p.default)((0,l.default)(n),"handleSessionEnded",(function(){(0,n.props.dispatch)((0,C.setChromecastState)(!1)),n.props.onSessionEnded()})),(0,p.default)((0,l.default)(n),"handleEnded",(function(){var e=n.props,t=e.dispatch,a=e.player;t((0,C.ended)()),a.queueIndex!==a.queue.length-1||a.repeat?t((0,C.next)()):t((0,C.stop)())})),(0,p.default)((0,l.default)(n),"handleTimeUpdate",(function(){var e=n.props.dispatch;n.state.isCurrentWithinChromecast&&e((0,C.timeUpdate)(n._chromecast.currentTime))})),(0,p.default)((0,l.default)(n),"handlePlaybackStateChange",(function(e){var t=n.props.dispatch;n.state.isCurrentWithinChromecast&&t(e?(0,C.pause)():(0,C.play)())})),(0,p.default)((0,l.default)(n),"handleVolumeChange",(function(e){(0,n.props.dispatch)((0,C.setVolume)(e))})),(0,p.default)((0,l.default)(n),"handleMediaInfoChange",(function(e,t){var a=(t||{}).customData||{},s=(t||{}).metadata||{},i="".concat(a.type,":").concat(a.id,":").concat(s.trackNumber),o=(e||{}).customData||{},r=(e||{}).metadata||{};if("".concat(o.type,":").concat(o.id,":").concat(r.trackNumber)!==i){var u=n.props.dispatch,l=n.isCurrentSong(e);n.setState({isCurrentWithinChromecast:l},(function(){l||(u((0,C.timeUpdate)(0)),u((0,C.pause)()))}))}})),n.state={isCurrentWithinChromecast:!1},n}return(0,u.default)(a,[{key:"componentDidMount",value:function(){var e=this;(0,y.loadScript)("https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1","chromecast-api").then((function(){e._chromecast=new _.default({onAvailablilityChange:e.handleAvailablilityChange,onSessionStart:e.handleSessionStart,onSessionResumed:e.handleSessionResumed,onSessionStartFailed:e.handleSessionStartFailed,onEnded:e.handleEnded,onTimeUpdate:e.handleTimeUpdate,onSessionEnded:e.handleSessionEnded,onVolumeChange:e.handleVolumeChange,onPlaybackStateChange:e.handlePlaybackStateChange,onMediaInfoChange:e.handleMediaInfoChange})})).catch((function(e){}))}},{key:"componentDidUpdate",value:function(e){if(this._chromecast){var t=this.props.player;if(e.player.paused!==t.paused&&this.setPlayerState(t.paused),e.player.muted!==t.muted){var a=t.muted?"mute":"unmute";this._chromecast[a]()}e.player.volume!==t.volume&&this._chromecast.volume(t.volume),t.seeking&&this._chromecast.seek(t.currentTime);var n=t.currentSong||{},s=e.player.currentSong||{},i="".concat(n.type,":").concat(n.id),o="".concat(s.type,":").concat(s.id);t.currentSong&&i!==o&&this.setChromecastMedia()}}},{key:"componentWillUnmount",value:function(){this._setMediaPromise=null,this._chromecast=null}},{key:"getCurrentSong",value:function(e){return e.currentSong||{}}},{key:"setChromecastMedia",value:function(){var e=this;if(this._chromecast.isActive()){var t=this.props,a=t.currentUser,n=t.player,s=t.promoKey,i=t.dispatch,r=a.token,u=a.secret;if(n.currentSong){var l=this._setMediaPromise||o.default.resolve();i((0,C.setChromecastLoading)(!0)),l=l.then((function(){return e._chromecast.setMedia(n,{token:r,secret:u,key:s}).then((function(){e.setState({isCurrentWithinChromecast:!0}),i((0,C.setChromecastLoading)(!1))})).catch((function(e){}))})),this._setMediaPromise=l}else this._chromecast.sendMessage(v.chromecastMessageTypes.idle)}}},{key:"setPlayerState",value:function(e){if(this.state.isCurrentWithinChromecast){var t=e?"pause":"play";this._chromecast&&this._chromecast[t]()}}},{key:"isCurrentSong",value:function(e){if(!e)return!1;var t=this.props.player,a=this.getCurrentSong(t);if(!e.customData)return e.metadata.title===a.title;var n=a.trackIndex||0,s=a.id,i=a.type;a.parentDetails&&(s=a.parentDetails.id,i=a.parentDetails.type);var o=e.metadata.trackNumber-1||0,r=e.customData,u=r.type;return s===r.id&&i===u&&n===o}},{key:"render",value:function(){return null}}]),a}(f.Component);(0,p.default)(k,"propTypes",{dispatch:m.default.func,player:m.default.object,currentUser:m.default.object,promoKey:m.default.string,onAvailablilityChange:m.default.func,onSessionStart:m.default.func,onSessionStartFailed:m.default.func,onSessionEnded:m.default.func,onSessionResumed:m.default.func}),(0,p.default)(k,"defaultProps",{onAvailablilityChange:function(){},onSessionResumed:function(){},onSessionStart:function(){},onSessionStartFailed:function(){},onSessionEnded:function(){}});var w=(0,S.connect)((function(e){return{player:e.player,currentUser:e.currentUser}}))(k);t.default=w},juIi:function(e,t,a){"use strict";var n=a("KI45"),s=a("hfKm"),i=a("2Eek"),o=a("XoMD"),r=a("Jo+v"),u=a("4mXO"),l=a("pLtp");s(t,"__esModule",{value:!0}),t.default=void 0;var c=n(a("eVuF")),d=n(a("/HRN")),h=n(a("WaGi")),p=n(a("xHqa")),f=a("31zi"),m=a("xY8W");function S(e,t){var a=l(e);if(u){var n=u(e);t&&(n=n.filter((function(t){return r(e,t).enumerable}))),a.push.apply(a,n)}return a}function y(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?S(Object(a),!0).forEach((function(t){(0,p.default)(e,t,a[t])})):o?i(e,o(a)):S(Object(a)).forEach((function(t){s(e,t,r(a,t))}))}return e}var v=["onAvailablilityChange","onMediaInfoChange","onSessionStart","onSessionStartFailed","onSessionResumed","onSessionEnded","onTimeUpdate","onEnded","onPlaybackStateChange","onVolumeChange"];function _(){}var C=function(){function e(){var t=this,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,d.default)(this,e),(0,p.default)(this,"_handleCastStateChange",(function(e){var a=e.castState,n=window.cast.framework.CastState,s=n.CONNECTED,i=n.CONNECTING,o=n.NOT_CONNECTED,r=n.NO_DEVICES_AVAILABLE;switch(a){case s:case i:case o:t._options.onAvailablilityChange(!0);break;case r:t._options.onAvailablilityChange(!1)}})),(0,p.default)(this,"_handleSessionStateChange",(function(e){var a=e.sessionState,n=window.cast.framework.SessionState,s=n.SESSION_STARTED,i=n.SESSION_START_FAILED,o=n.SESSION_RESUMED,r=n.SESSION_ENDED;switch(a){case s:t.castSession.addMessageListener("urn:x-cast:com.audiomack.chromecast",t._handleCustomMessage),t._options.onSessionStart();break;case o:t._options.onSessionResumed();break;case i:t._options.onSessionStartFailed();break;case r:t.castSession.endSession(!1),t._options.onSessionEnded()}})),(0,p.default)(this,"_handleAnyChange",(function(e){switch(e.field){case"currentTime":t._player.isPaused||t._options.onTimeUpdate(e.value);break;case"duration":t.duration=e.value;break;case"isPaused":t._options.onPlaybackStateChange(e.value);break;case"mediaInfo":var a=e.value||null,n=null;t.currentMediaInfo&&(n=y({},t.currentMediaInfo)),a&&(t.currentMediaInfo=a,t._options.onMediaInfoChange(a,n));break;case"volume":t._options.onVolumeChange(e.value)}})),(0,p.default)(this,"_handleCustomMessage",(function(e,a){if(JSON.parse(a).type===f.chromecastMessageTypes.ended)t._options.onEnded()})),this._options=a,v.forEach((function(e){t._options[e]=a[e]||_})),window.__onGCastApiAvailable=function(e){e&&(t._setupInstanceVars(),t._initializeCastApi())},this._duration=0}return(0,h.default)(e,[{key:"currentTime",get:function(){return this._player&&this._player.currentTime||0}},{key:"paused",get:function(){return!this._player||this._player.isPaused}},{key:"duration",get:function(){return!this._player||(this._player.duration||this._duration)},set:function(e){this._duration=e}},{key:"deviceName",get:function(){return this.isActive()?this.castSession.getCastDevice().friendlyName:null}},{key:"castSession",get:function(){return window.cast.framework.CastContext.getInstance().getCurrentSession()}},{key:"currentMediaInfo",get:function(){return this._currentMediaInfo||null},set:function(e){this._currentMediaInfo=e}},{key:"setMedia",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=t.contentType,n=void 0===a?"audio/mp3":a,s=t.token,i=t.secret,o=t.key,r=e.currentSong,u=r.streaming_url,l=r.trackIndex,c=window.chrome.cast.media,d=c.MediaInfo,h=c.StreamType,p=c.MusicTrackMediaMetadata,f=c.MetadataType,S=c.LoadRequest,y=new d(u,n);y.streamType=h.BUFFERED;var v=new p;v.title=r.title,v.artist=r.artist,v.images=[new window.chrome.cast.Image(r.image)],v.metadataType=f.MUSIC_TRACK,v.releaseDate=new Date(1e3*r.released).toISOString(),v.songName=r.title,v.albumName=r.album;var _=(0,m.getConfig)(),C=_.baseUrl,g=_.consumerKey,k=_.consumerSecret,w={id:r.id,type:r.type,apiKey:g,apiSecret:k,apiUrl:C,key:o,token:s,secret:i};if(r.parentDetails){var E=r.parentDetails.type,M=r.parentDetails.id;v.trackNumber=l+1,w.id=M,w.type=E,v.albumName=r.parentDetails.title}y.metadata=v,y.customData=w,this._player.canSeek=!0,this._player.canPause=!0,this._player.canControlVolume=!0;var I=new S(y);return I.autoplay=!e.paused,I.currentTime=e.currentTime,this.castSession.loadMedia(I)}},{key:"sendMessage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.castSession?this.castSession.sendMessage("urn:x-cast:com.audiomack.chromecast",y(y({},t),{},{type:e})):c.default.reject("Cast session not initialized")}},{key:"play",value:function(){this._player&&this._player.isPaused&&this._playerController.playOrPause()}},{key:"pause",value:function(){this._player&&(this._player.isPaused||this._playerController.playOrPause())}},{key:"stop",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._playerController&&this._playerController.stop(),this.castSession&&e&&this.castSession.endSession()}},{key:"seek",value:function(e){this._player&&(this._player.currentTime=e,this._playerController.seek(e))}},{key:"volume",value:function(e){this._player&&(this._player.volumeLevel=e,this._playerController.setVolumeLevel(e))}},{key:"mute",value:function(){this._player&&!this._player.isMuted&&this._playerController.muteOrUnmute()}},{key:"unmute",value:function(){this._player&&this._player.isMuted&&this._playerController.muteOrUnmute()}},{key:"isActive",value:function(){if(!(!!window.cast&&!!this.castSession))return!1;var e=this.castSession.getSessionState(),t=window.cast.framework.SessionState;return[t.SESSION_STARTED,t.SESSION_RESUMED].includes(e)}},{key:"_setupInstanceVars",value:function(){var e=window.cast.framework.RemotePlayerEventType.ANY_CHANGE;this._player=new window.cast.framework.RemotePlayer,this._playerController=new window.cast.framework.RemotePlayerController(this._player),this._playerController.addEventListener(e,this._handleAnyChange)}},{key:"_initializeCastApi",value:function(){var e=window.cast.framework.CastContext.getInstance();e.setOptions({autoJoinPolicy:window.chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED,receiverApplicationId:"5393CD0A"});var t=window.cast.framework.CastContextEventType,a=t.CAST_STATE_CHANGED,n=t.SESSION_STATE_CHANGED;e.addEventListener(a,this._handleCastStateChange),e.addEventListener(n,this._handleSessionStateChange),this._handleCastStateChange({castState:e.getCastState()})}}]),e}();t.default=C}}]);